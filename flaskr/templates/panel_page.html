{% extends 'base.html' %}

{% block title %}Panel Modelling{% endblock %}

{% block content %}
<div style="width: 100%; min-height: 100vh; padding: 2rem;">
  <h1 class="page-title">Panel Model</h1>

  <!-- Filter Section -->
  <div class="form-section">
    <h2 class="section-title">Filter Panels</h2>
    <form method="POST" id="filterForm">
      <div class="input-grid">
        <div class="input-group">
          <label for="panel-input">Select Panel:</label>
          <input list="panels" id="panel-input" name="panel_name" autocomplete="off" 
                 value="{{ panel_name or '' }}" placeholder="Choose or type panel name"/>
          <datalist id="panels">
            {% for name in panel_names %}
              <option value="{{ name }}"></option>
            {% endfor %}
          </datalist>
        </div>

        <div class="input-group">
          <label for="power_input">Power Output (W):</label>
          <input type="number" name="power_input" id="power_input" min="0" max="1000" step="1" 
                 value="{{ power or '' }}" placeholder="Enter power in watts"/>
        </div>

        <div class="input-group">
          <label for="height_input">Panel Height (m):</label>
          <input type="number" name="height_input" id="height_input" min="0" max="5" step="0.1" 
                 value="{{ height or '' }}" placeholder="Enter height in meters"/>
        </div>
        
        <div class="input-group">
          <label for="width_input">Panel Width (m):</label>
          <input type="number" name="width_input" id="width_input" min="0" max="5" step="0.1" 
                 value="{{ width or '' }}" placeholder="Enter width in meters"/>
        </div>
      </div>
      
      <button type="button" class="button-primary" onclick="filterTable()">
        <span>üîç Filter Results</span>
      </button>
    </form>
  </div>

  <!-- Results Table Section -->
  <div class="form-section">
    <h2 class="section-title">Panel Results</h2>
    <form method="POST" id="editUpdate">
      <div class="table-container">
        <table id="panel-table">
          <thead>
            <tr>
              <th>Panel Name</th>
              <th>Height (m)</th>
              <th>Width (m)</th>
              <th>Number of Cells</th>
              <th>Max Power (W)</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data populated via JavaScript -->
          </tbody>
        </table>
      </div>
      
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
        <button type="button" class="button-primary" onclick="calcPower()">
          <span>‚ö° Calculate Power</span>
        </button>
        <button type="button" class="button-secondary" onclick="updateDB()">
          <span>üíæ Save Changes</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Create New Panel Section -->
  <div class="form-section">
    <h2 class="section-title">Create New Panel</h2>
    <p style="color: var(--text-secondary); margin-bottom: 2rem; font-style: italic;">
      üìã Enter specifications at Reference Test Conditions (STC) - See manufacturer data sheet
    </p>
    
    <form id="newForm">
      <div class="input-grid">
        <!-- Basic Panel Information -->
        <div class="input-group">
          <label for="panel_name">Panel Model Name:</label>
          <input type="text" id="panel_name" name="panel_name" 
                 value="{{ panel_name or '' }}" placeholder="e.g., SunPower SPR-400E-WHT"/>
        </div>

        <div class="input-group">
          <label for="panel_type">Panel Technology:</label>
          <select id="panel_type" name="panel_type">
            <option value="mono">Monocrystalline Silicon</option>
            <option value="multi/poly">Polycrystalline Silicon</option>
          </select>
        </div>

        <!-- Physical Dimensions -->
        <div class="input-group">
          <label for="panel_length">Panel Length (m):</label>
          <input type="number" id="panel_length" name="panel_length" min="0.5" max="3" step="0.01" 
                 value="{{ panel_length or 1.65 }}" placeholder="1.65"/>
        </div>

        <div class="input-group">
          <label for="panel_width">Panel Width (m):</label>
          <input type="number" id="panel_width" name="panel_width" min="0.3" max="2" step="0.01" 
                 value="{{ panel_width or 1 }}" placeholder="1.00"/>
        </div>

        <!-- Electrical Characteristics at STC -->
        <div class="input-group">
          <label for="Voc">Open-Circuit Voltage - Voc (V):</label>
          <input type="number" id="Voc" name="Voc" min="0" max="100" step="0.1" 
                 value="{{ Voc or 40 }}" placeholder="40.0"/>
        </div>

        <div class="input-group">
          <label for="Isc">Short-Circuit Current - Isc (A):</label>
          <input type="number" id="Isc" name="Isc" min="0" max="15" step="0.01" 
                 value="{{ Isc or 8 }}" placeholder="8.00"/>
        </div>

        <div class="input-group">
          <label for="Vmp">Maximum Power Voltage - Vmp (V):</label>
          <input type="number" id="Vmp" name="Vmp" min="0" max="100" step="0.1" 
                 value="{{ Vmp or 32 }}" placeholder="32.0"/>
        </div>

        <div class="input-group">
          <label for="Imp">Maximum Power Current - Imp (A):</label>
          <input type="number" id="Imp" name="Imp" min="0" max="15" step="0.01" 
                 value="{{ Imp or 7.5 }}" placeholder="7.50"/>
        </div>

        <!-- Temperature Coefficients -->
        <div class="input-group">
          <label for="alpha_sc">Temperature Coefficient of Isc (%/¬∞C):</label>
          <input type="number" id="alpha_sc" name="alpha_sc" min="0" max="1" step="0.0001" 
                 value="{{ alpha_sc or 0.004 }}" placeholder="0.0040"/>
        </div>

        <div class="input-group">
          <label for="beta_voc">Temperature Coefficient of Voc (%/¬∞C):</label>
          <input type="number" id="beta_voc" name="beta_voc" min="-1" max="0" step="0.0001" 
                 value="{{ beta_voc or -0.004 }}" placeholder="-0.0040"/>
        </div>

        <div class="input-group">
          <label for="gamma_pmp">Temperature Coefficient of Pmax (%/¬∞C):</label>
          <input type="number" id="gamma_pmp" name="gamma_pmp" min="-1" max="0" step="0.0001" 
                 value="{{ gamma_pmp or -0.004 }}" placeholder="-0.0040"/>
        </div>

        <!-- Cell Configuration -->
        <div class="input-group">
          <label for="num_cells">Number of Cells in Series:</label>
          <input type="number" id="num_cells" name="num_cells" min="10" max="200" step="1" 
                 value="{{ num_cells or 60 }}" placeholder="60"/>
        </div>

        <div class="input-group">
          <label for="num_diodes">Number of Bypass Diodes:</label>
          <input type="number" id="num_diodes" name="num_diodes" min="1" max="12" step="1" 
                 value="{{ num_diodes or 3 }}" placeholder="3"/>
        </div>

        <!-- Operating Conditions -->
        <div class="input-group">
          <label for="noct">Nominal Operating Cell Temp - NOCT (¬∞C):</label>
          <input type="number" id="noct" name="noct" min="35" max="55" step="0.1" 
                 value="{{ noct or 45 }}" placeholder="45.0"/>
        </div>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 2rem;">
        <button type="button" class="button-primary" onclick="newPanel()">
          <span>‚ú® Create New Panel</span>
        </button>
        <button type="button" class="button-secondary" onclick="clearForm()">
          <span>üóëÔ∏è Clear Form</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Status Messages -->
  {% if error %}
    <div class="status-message error-message" style="display: flex;">
      <span>‚ö†Ô∏è</span>
      <strong>Error:</strong> {{ error }}
    </div>
  {% endif %}

  <div id="success-message" class="status-message success-message">
    <span>‚úÖ</span>
    <span id="success-text">Operation completed successfully!</span>
  </div>

  <div id="error-message" class="status-message error-message">
    <span>‚ùå</span>
    <span id="error-text">An error occurred. Please try again.</span>
  </div>

  <div id="info-message" class="status-message">
    <span>‚ÑπÔ∏è</span>
    <span id="info-text">Processing your request...</span>
  </div>
</div>

<script src="{{ url_for('static', filename='javascript/grid.js')}}"></script>
{% endblock %}